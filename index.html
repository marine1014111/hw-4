<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="D3 hw4 1 : ">
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <title>D3 hw4 1</title>
</head>

<body>
    <!-- HEADER -->
    <!-- MAIN CONTENT -->
    <h3>
<hr>一、建立簡單動態圖表 </h3>
 
   
    <p>
      
       <input type="button" value="new" onclick="update()">
       <svg width="100000" height="920"></svg>
        
<script>
    var h=300;
    var w=700;
    var p=50;
    var arr=[45,76,96,35,88,69]
    svg(w,h,p);
    bind(arr);
    render(w,h,p);
    bind2(arr);
    render2(w,h,p);
    
    function svg(w,h,p){
        d3.select("body").append("svg").attr({
            width: w,
            height: h
        })
    }
   
    function bind(data){
      var selection = d3.select("svg")
               .selectAll("rect")
               .data(data);
        selection.enter().append("rect");
        selection.exit().remove();

}
    function update(){
        var num = random(20,100)
        arr.push(num)
        bind(arr);
        render(w,h,p);
        bind2(arr);
        render2(w,h,p);
    }
    function render(w,h,p){
            d3.selectAll("rect").attr({
                x:function(d,i){return p+45*i;},
                y:function(d){return h-p-d;},
                width:40,
                height:function(d){return d;},
                fill:function(d){
                    if(d<70){return "red";
                            }
                    else{
                        return "lightgreen";
                    }
                    
                },
              
            })

}
    
     function bind2(data){
      var selection = d3.select("svg")
               .selectAll("text")
               .data(data);
        selection.enter().append("text");
        selection.exit().remove();

}
    
    function render2(w,h,p){
            d3.selectAll("text").attr({
                x:function(d,i){return p+5+46*i;},
                y:function(d){return h-p+20;},
                fill:"blacl"
                    }).text(function(d){return d;
              
            })

}
     function random(n,m){return Math.ceil(Math.random()*(m-n)+n);}
    
    </script>
 
    </p>
    <p>
   
       
         <script>
    
            d3.json("invoice-taipei.json", function (dataSet) {
                var body = d3.select("svg");
                var count = 0;
                body.append("text").attr({
                            x: 20,
                            y: 450 + 32 * count,
                            "font-size": 20
                        }).text("二、2016年8月1日台北市發票金額>10億");
                body.append("text").attr({
                            x: 20,
                            y: 900 + 32 * count,
                            "font-size": 20
                        }).text("三、把數字小於70改成紅色");
                for (var i = 0; i < dataSet.length; i++) {
                    if (dataSet[i].date === "2016/8/1" && dataSet[i].cid === "A" && parseInt(dataSet[i].amount) > 1000000000) {
                        body.append("rect").attr({
                            x: 350,
                            y: 500 + 32 * count,
                            width: dataSet[i].amount / 100000000,
                            height: 10,
                            fill: "red"
                        });
                        body.append("text").attr({
                            x: 20,
                            y: 500 + 32 * count,
                            "font-size": 18
                        }).text(dataSet[i].industry);
                        count = count + 1;
                    }
                }
            });
             
             
             
             
               var arr = [85, 60, 99, 49, 77, 82];
            bind(arr);
            render();

            function bind(data) {
                var selection = d3.select("body").selectAll("div").data(data);
                selection.enter().append("div");
                selection.exit().remove();
            }

            function render() {
                d3.selectAll("div").text(function (d, i) {
                    return i + "," + d;
                })
            };
            d3.selectAll("div").style({
                color: function (d) {
                    if (d < 70) {
                        return "red";
                    } else {
                        return "black";
                    }
                }
            });
        </script>
        
    </p>
  
    
   </body>

    
     
</html>